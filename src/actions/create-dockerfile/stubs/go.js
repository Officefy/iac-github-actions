const fs = require('fs')
const path = require('path')

module.exports = {
  stub: `
# This file was autogenerated at <%= generatedAt %>.

# Build Step
FROM <%= image %>:<%= tag %> as builder

WORKDIR /svc
COPY . /svc

RUN go version \
  && mkdir /svc/out \
  && <%= dependencyCommand %> \
  && go build -o ./out/go-app .


# Final step
FROM alpine:3.9 

WORKDIR /svc

RUN apk add ca-certificates

<% labels.length && print("LABEL " + labels.join(' \\\n\t')) %>
<% environmentVariables.length && print("ENV "+ environmentVariables.join(' \\\n\t')) %>

COPY --from=builder /svc/out/go-app /src/go-app

ENTRYPOINT ["<%= entrypoint %>"]
CMD ["<%= command %>"]
`,

  defaultValues: {
    image: "golang",
    tag: "1.18",
    labels: ["builder=pipeline"],
    environmentVariables: ["OS=Alpine"],
    dependencyCommand: "go mod download",
    entrypoint: "./go-app",
    command: "",
  },

  files: [],
};
