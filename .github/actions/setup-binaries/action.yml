name: 'Setup binaries'
description: 'Greet someone'

inputs:
  docker-qmeu:
    description: 'Install'
    required: false
    default: 'false'
  docker-buildx:
    description: 'Install'
    required: false
    default: 'false'
  kubectl:
    description: 'Install'
    required: false
    default: 'false'
  nodejs:
    description: 'Inform the Nodejs version'
    required: false
    default: 'false'
  yq:
    description: 'Install'
    required: false
    default: 'false'
  ytt:
    description: 'Install'
    required: false
    default: 'false'

outputs:
  buildx_name:
    description: ""
    value: ${{steps.docker-buildx.outputs.name}}

runs:
  using: "composite"

  steps:
    # nodejs
    - if: inputs.nodejs != 'false'
      uses: actions/setup-node@v3
      id: node
      with:
        node-version: ${{ inputs.nodejs }}

    - if: inputs.nodejs != 'false'
      shell: bash
      id: npm
      run: npm -g install yarn npm

    # docker
    - if: inputs.docker-qmeu != 'false'
      uses: docker/setup-qemu-action@v1
      id: docker-qmeu

    - if: inputs.docker-buildx != 'false'
      uses: docker/setup-buildx-action@master
      id: docker-buildx
      with:
        install: true

    - if: inputs.kubectl != 'false'
      uses: azure/setup-kubectl@v2.1
      id: kubectl
    
    - if: inputs.ytt != 'false'
      uses: vmware-tanzu/carvel-setup-action@v1
      id: ytt
      with:
        only: ytt
        token: ${{ secrets.GITHUB_TOKEN }}

    - if: inputs.yq != 'false'
      shell: bash
      id: yq
      env:
        VERSION: v4.25.2
        BINARY: yq_linux_amd64
      run: |
        wget https://github.com/mikefarah/yq/releases/download/${VERSION}/${BINARY}.tar.gz -O - | tar xz && sudo mv ${BINARY} /usr/bin/yq
        yq --version
